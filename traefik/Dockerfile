FROM traefik:latest

ARG PROJECT_NAME
ARG DOMAIN
ARG CERTRESOLVER
ARG IP_ALLOWLIST
ARG ACME_EMAIL
ARG HOMEASSISTANT_IP
ARG HOMEASSISTANT_SERVER
ARG LOCKMASTER_HOST

ENV PROJECT_NAME ${PROJECT_NAME}
ENV DOMAIN ${DOMAIN}
ENV CERTRESOLVER  ${CERTRESOLVER}
ENV IP_ALLOWLIST ${IP_ALLOWLIST}
ENV ACME_EMAIL ${ACME_EMAIL}
ENV HOMEASSISTANT_IP ${HOMEASSISTANT_IP}
ENV HOMEASSISTANT_SERVER ${HOMEASSISTANT_SERVER}
ENV LOCKMASTER_HOST ${LOCKMASTER_HOST}

COPY traefik.toml /var/traefik/traefik.toml
COPY conf.d /var/traefik/conf.d
COPY entrypoint.sh /entrypoint.sh

WORKDIR /etc/traefik

VOLUME /var/certs

EXPOSE 80/tcp 443/tcp 8080/tcp

RUN apk add --no-cache gettext \
    && chmod +x /entrypoint.sh
